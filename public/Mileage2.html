<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mileage2</title>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <div class="card">
        <h2>Please Enter Start Location: <br></h2>
        Street:<input id="startStreet" class="input" type="text"><br>
        City:<input id="startCity" class="input" type="text"><br>
        State:<input id="startState" class="input" type="text"><br>
    </div>

    <div id="page"></div>
    <div id="Stops">
        How Many Stops on your route?
        <select id="dropdown">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <input id="submitStops" type="submit">
    </div>


    <script>
        $("#page").html("<br>");
        var dropdownVal = "";
        var stopsArr = []
        // click function for "How many stops?" submit button
        $("#submitStops").click(function (event) {
            event.preventDefault();

            populateStops($('#dropdown').val());
            dropdownVal = $('#dropdown').val();

            // populateStops function where 'x' is the number selected in the dropdown.
            function populateStops(x) {
                // Remove previous divs if "dropdown" number changes.
                $("<div/>").attr('id', 'Stops').appendTo('page');
                for (let j = 5; j >= 0; j--) {
                    let stop = "stop" + j;
                    $('.' + stop).remove();
                }
                var i = 0;
                // Generate [i] number of input fields, where [i] is 'dropdown' number.
                for (var i = 1; i <= x; i++) {
                    var stop = "stop" + i;
                    var street = "street" + i;
                    var city = "city" + i;
                    var state = "state" + i;
                    $("#Stops").append("<div class=" + stop + ">");
                    // console.log(stop);
                    $('.' + stop).html("<h2>Stop " + i + ": <br></h2>" +
                        "Street:<input id='" + street + "' class='input' type='text'><br>" +
                        "City:<input id='" + city + "' class='input' type='text'><br>" +
                        "State:<input id='" + state + "' class='input' type='text'><br>");
                }
                // prevents additional 'submit' buttons from appending on page
                $("#submitApi").remove();
                // create submit button after all 'stops' inputs
                $("#Stops").append("<input id='submitApi' type='submit'></div>")
                console.clear();
                console.log(
                    i - 1 + " stops entered" +
                    "\n-----------------------");
            }
        });

        // click function to initialize API call with 'stops' 
        $(document).on('click', '#submitApi', function (event) {
            event.preventDefault();
            var apiKey = "AIzaSyCHZqKS_YadIq4eOAtVad2cxcHixlT6poI"


            // Start Location
            var startStreet = $("#startStreet").val();
            var startCity = $("#startCity").val();
            var startState = $("#startState").val();

            var ip = "https://maps.googleapis.com/maps/api/geocode/json?address=" + startStreet.split(" ").join("+") + ",+" + startCity.split(" ").join("+") + ",+" + startState + "&sensor=false&key=" + apiKey;
            // Ajax call for to convert address to lat/long
            $.ajax({
                url: ip,
                method: "GET"
            }).then(function (response) {
                var addr = response.results[0].formatted_address;
                var lat = response.results[0].geometry.location.lat;
                var long = response.results[0].geometry.location.lng;
                var coords = lat + "," + long + ";";
                // push lat/long to 'stopsArr' array.
                stopsArr.push(coords);
                console.log("START: \n" + addr + "\n" + lat + ", " + long);

                // *********** STOPS API ************* //
                for (var i = 1; i <= dropdownVal; i++) {
                    var apiAddress = (($('#street' + i).val()).split(" ").join("+")) + ",+" + (($('#city' + i).val()).split(" ").join("+")) + ",+" + $('#state' + i).val();
                    // console.log(apiAddress);
                    var ip = "https://maps.googleapis.com/maps/api/geocode/json?address=" + apiAddress + "&sensor=false&key=" + apiKey;

                    $.ajax({
                        url: ip,
                        method: "GET"
                    }).then(function (response) {
                        var addr = response.results[0].formatted_address;
                        var lat = response.results[0].geometry.location.lat;
                        var long = response.results[0].geometry.location.lng;
                        var coords = lat + "," + long + ";";
                        stopsArr.push(coords);
                        // console.log(addr + "\n" + lat + ", " + long);
                    });
                };
            });
            $("#submitApi").remove();
        });



            // ************** Reference from start **************** // 
            // // Get info from input fields
            // var startStreet = $("#startStreet").val();
            // var startCity = $("#startCity").val();
            // var startState = $("#startState").val();

    </script>
</body>

</html>